<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Merry Christmas â€” Surprise Gift</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --bg-1:#04102a; --bg-2:#071033;
    --red:#c62828; --green:#2e7d32; --gold:#b8860b;
    --glow: 0 0 14px rgba(255,200,100,0.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 60%);
    color:#fff; min-height:100vh; display:flex; flex-direction:column; align-items:center;
  }

  /* Snow canvas (hidden until open) */
  #snow {
    position:fixed; inset:0; pointer-events:none; z-index:0; opacity:0; transition:opacity .8s ease;
  }

  main{ width:100%; max-width:980px; padding:28px 20px 90px; z-index:1; }

  header.hero{ text-align:center; margin-top:18px; padding:26px 8px 6px; }
  header.hero h1{ font-size:clamp(28px,5vw,48px); margin:0; }
  header.hero p.lead{ margin:10px 0 0; font-size:clamp(14px,2.2vw,18px); color:#e8eefc; opacity:0.95; }

  /* Boxes */
  .boxes{ display:flex; justify-content:center; gap:18px; margin-top:36px; flex-wrap:wrap; }
  .box-wrap{ width:110px; height:140px; perspective:900px; display:flex; align-items:flex-end; justify-content:center; }
  .box{
    width:100px; height:100px; border-radius:12px; position:relative; transform-origin:50% 80%;
    transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .25s; box-shadow: 0 10px 30px rgba(0,0,0,0.45), var(--glow);
    display:flex; align-items:center; justify-content:center; overflow:visible;
  }
  .box.box1{ background: linear-gradient(180deg,var(--red), #a31f1f); }
  .box.box2{ background: linear-gradient(180deg,var(--green), #225e23); }
  .box.box3{ background: linear-gradient(180deg,var(--gold), #8a6f02); }
  .box.box4{ background: linear-gradient(180deg,var(--red), #a31f1f); }
  .box.box5{ background: linear-gradient(180deg,var(--green), #225e23); }

  .box::before{ content:""; position:absolute; left:50%; top:0; width:8px; height:100%; transform:translateX(-50%); border-radius:4px; background:linear-gradient(180deg, rgba(0,0,0,0.06), rgba(255,255,255,0.04)); }
  .box::after{ content:""; position:absolute; top:40%; left:0; width:100%; height:12px; border-radius:8px; background:linear-gradient(90deg, rgba(0,0,0,0.06), rgba(255,255,255,0.04)); transform:translateY(-50%); }

  .lid{
    position:absolute; top:-12px; left:50%; transform:translateX(-50%) rotateX(0deg); width:110px; height:36px;
    border-top-left-radius:10px; border-top-right-radius:10px; z-index:5; transition: transform 1100ms cubic-bezier(.22,.8,.2,1);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.06)); box-shadow:0 8px 20px rgba(0,0,0,0.35);
  }
  .bow{ position:absolute; top:-4px; left:50%; transform:translateX(-50%); width:36px;height:18px; z-index:6; display:flex; align-items:center; justify-content:center; }
  .bow::before, .bow::after{ content:""; width:14px;height:14px;border-radius:50%; background:linear-gradient(180deg, rgba(255,255,255,0.14), rgba(0,0,0,0.06)); display:inline-block; }

  .count-badge{ position:absolute; right:-12px; top:-10px; background:rgba(0,0,0,0.45); padding:6px 8px; border-radius:999px; font-size:12px; color:#fff; opacity:0.95; box-shadow:0 6px 18px rgba(0,0,0,0.45); }

  @keyframes bounceUpDown {
    0%{ transform: translateY(0) rotateX(0deg); }
    30%{ transform: translateY(-14px) rotateX(1deg); }
    60%{ transform: translateY(0) rotateX(-1deg); }
    100%{ transform: translateY(0) rotateX(0deg); }
  }
  .active { animation: bounceUpDown 800ms ease-in-out infinite; box-shadow: 0 18px 46px rgba(0,0,0,0.55), 0 0 34px rgba(255,215,120,0.08); z-index:4; filter: drop-shadow(0 12px 18px rgba(0,0,0,0.6)); }
  .active-glow{ box-shadow: 0 14px 44px rgba(0,0,0,0.45), 0 0 30px rgba(255,255,180,0.12), 0 0 18px rgba(30,200,120,0.06); outline:2px solid rgba(255,255,255,0.03); }
  .dim{ opacity:0.66; transform: translateY(var(--depressed,0px)) scale(.98); }

  .opened{ transform: scale(1.04) translateY(-8px) !important; box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 60px rgba(255,215,120,0.06); }
  .message { position:absolute; top:110%; left:50%; transform:translateX(-50%) translateY(10px); max-width:240px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); color:#fff; border-radius:10px; padding:12px; box-shadow: 0 12px 30px rgba(0,0,0,0.5); opacity:0; transition: all 600ms cubic-bezier(.2,.8,.2,1); text-align:center; z-index:9; font-size:13px; }
  .show-message{ opacity:1; transform: translateX(-50%) translateY(0); }

  .cta-wrap{ margin-top:28px; display:flex; justify-content:center; gap:12px; }
  .btn{ border:0; outline:0; background:linear-gradient(90deg,#ff6b6b,#ffb74d); padding:10px 16px; border-radius:999px; color:#05060b; font-weight:600; cursor:pointer; box-shadow:0 10px 28px rgba(0,0,0,0.45); transition: transform 180ms ease, box-shadow 180ms; }
  .btn:hover{ transform:translateY(-4px); box-shadow:0 18px 34px rgba(0,0,0,0.55); }

  /* Modal */
  .modal-backdrop{ position:fixed; inset:0; background: rgba(4,8,20,0.6); display:none; align-items:center; justify-content:center; z-index:40; }
  .modal{ width:min(640px,calc(100% - 32px)); background: linear-gradient(180deg,#071028,#09142a); border-radius:12px; padding:18px; box-shadow: 0 18px 60px rgba(0,0,0,0.7); border:1px solid rgba(255,255,255,0.03); color:#e6eefc; }
  .modal h3{ margin:0 0 8px 0; }
  .field{ margin:8px 0; display:flex; flex-direction:column; gap:8px; }
  .field input, .field textarea{ background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); padding:10px 12px; color:#fff; border-radius:8px; outline:none; }
  .field textarea{ min-height:60px; resize:vertical; }

  .link-output{ margin-top:12px; display:flex; gap:8px; align-items:center; }
  .link-output input{ flex:1; background: rgba(255,255,255,0.02); border:1px dashed rgba(255,255,255,0.04); color:#fff; padding:8px 10px;border-radius:8px; }

  footer.site-footer{ width:100%; text-align:center; padding:14px 10px; color:#d8e6ff; opacity:0.8; margin-top:auto; font-size:13px; }
  @media (max-width:560px){ .box-wrap{ width:90px;height:120px; } .box{ width:90px;height:90px; } .lid{ width:96px;height:30px; top:-10px; } .message{ max-width:180px; font-size:13px; } }
</style>
</head>
<body>

<canvas id="snow"></canvas>

<main>
  <header class="hero" role="banner">
    <h1 id="greetings">Merry Christmas!</h1>
    <p class="lead" id="subtitle">As your long time friend, choose one gift you'd like from me</p>
  </header>

  <section aria-label="Gift boxes" class="boxes" id="boxes"></section>

  <div class="cta-wrap">
    <button class="btn" id="createBtn">Create to a Friend</button>
  </div>
</main>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="createTitle">
    <h3 id="createTitle">Create for a friend</h3>

    <div class="field">
      <label for="friendName">Enter recipient's name</label>
      <input id="friendName" placeholder="e.g. Brian" />
    </div>

    <div class="field">
      <label>Enter messages for each box</label>
      <input id="m1" placeholder="Message for Box 1" />
      <input id="m2" placeholder="Message for Box 2" />
      <input id="m3" placeholder="Message for Box 3" />
      <input id="m4" placeholder="Message for Box 4" />
      <input id="m5" placeholder="Message for Box 5" />
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button class="btn" id="generateLinkBtn">Generate Link</button>
      <button class="btn" id="modalClose" style="background:linear-gradient(90deg,#9aa4ff,#b8ffdf)">Close</button>
    </div>

    <div class="link-output" id="linkOutput" style="display:none">
      <input id="generatedLink" readonly />
      <button class="btn" id="copyLinkBtn">Copy Link</button>
    </div>

  </div>
</div>

<footer class="site-footer">Powered by Rodgers Â©2025</footer>

<script>
/* ---------- Config & Defaults ---------- */
const BOX_COUNT = 5;
const DEFAULT_MESSAGES = [
  "Mkipika chapo kwenu 25th usinisahau bwana ðŸ˜‚ðŸ¤­",
  "Mkipika chapo kwenu 25th usinisahau bwana ðŸ˜‚ðŸ¤­",
  "Mkipika chapo kwenu 25th usinisahau bwana ðŸ˜‚ðŸ¤­",
  "Mkipika chapo kwenu 25th usinisahau bwana ðŸ˜‚ðŸ¤­",
  "Mkipika chapo kwenu 25th usinisahau bwana ðŸ˜‚ðŸ¤­"
];

function getParams(){
  const u = new URL(window.location.href);
  const p = {};
  p.name = u.searchParams.get('name') ? decodeURIComponent(u.searchParams.get('name')) : null;
  p.messages = [];
  for(let i=1;i<=BOX_COUNT;i++){
    const v = u.searchParams.get('m'+i);
    p.messages.push(v ? decodeURIComponent(v) : null);
  }
  return p;
}
const params = getParams();
const receiverName = params.name || null;
const messagesFromLink = params.messages.map((m,i)=> m || DEFAULT_MESSAGES[i]);

/* ---------- Elements ---------- */
const greetingsEl = document.getElementById('greetings');
const subtitleEl = document.getElementById('subtitle');
const boxesContainer = document.getElementById('boxes');
const createBtn = document.getElementById('createBtn');
const modalBackdrop = document.getElementById('modalBackdrop');
const modalClose = document.getElementById('modalClose');
const generateLinkBtn = document.getElementById('generateLinkBtn');
const friendNameInput = document.getElementById('friendName');
const mInputs = [document.getElementById('m1'),document.getElementById('m2'),document.getElementById('m3'),document.getElementById('m4'),document.getElementById('m5')];
const linkOutput = document.getElementById('linkOutput');
const generatedLinkInput = document.getElementById('generatedLink');
const copyLinkBtn = document.getElementById('copyLinkBtn');
const canvas = document.getElementById('snow');
const ctx = canvas.getContext('2d');

/* ---------- State ---------- */
let boxes = [];
let activeIndex = null;
let clickCounts = new Array(BOX_COUNT).fill(0);
let depressedOffsets = new Array(BOX_COUNT).fill(0);
let opened = false;
let targetMessage = messagesFromLink.slice(); // per-box messages

/* ---------- Greeting ---------- */
if(receiverName){
  greetingsEl.textContent = `Merry Christmas, ${receiverName}!`;
} else {
  greetingsEl.textContent = 'Merry Christmas!';
}

/* ---------- Build Boxes ---------- */
function buildBoxes(){
  for(let i=0;i<BOX_COUNT;i++){
    const wrap = document.createElement('div');
    wrap.className = 'box-wrap';
    wrap.style.setProperty('--depressed','0px');

    const box = document.createElement('div');
    box.className = `box box${i+1}`;
    box.setAttribute('data-index', i);

    const lid = document.createElement('div'); lid.className = 'lid';
    const bow = document.createElement('div'); bow.className = 'bow';
    const badge = document.createElement('div'); badge.className = 'count-badge'; badge.textContent = '0';
    const msg = document.createElement('div'); msg.className = 'message';
    msg.textContent = '';

    box.appendChild(lid);
    box.appendChild(bow);
    box.appendChild(badge);
    box.appendChild(msg);
    wrap.appendChild(box);

    box.addEventListener('click', ()=> onBoxClick(i));
    boxesContainer.appendChild(wrap);
    boxes.push({wrap, box, lid, bow, badge, msg});
  }
}
buildBoxes();

/* ---------- Box click logic (secret: no hint in UI) ---------- */
function onBoxClick(i){
  if(opened) return;

  // if same as active, increment count
  if(activeIndex === i){
    clickCounts[i] = (clickCounts[i] || 0) + 1;
    boxes[i].badge.textContent = clickCounts[i];
    // small pulse feedback
    boxes[i].box.style.transform = 'scale(1.02)';
    setTimeout(()=> boxes[i].box.style.transform = '', 120);

    if(clickCounts[i] >= 5){
      openBox(i);
    }
    return;
  }

  // else switching active box
  const prev = activeIndex;
  activeIndex = i;

  // deactivate prev
  if(prev !== null && prev !== undefined){
    boxes[prev].box.classList.remove('active','active-glow');
    boxes[prev].box.classList.add('dim');
    depressedOffsets[prev] += 18;
    boxes[prev].wrap.style.setProperty('--depressed', depressedOffsets[prev] + 'px');
    boxes[prev].wrap.style.transform = `translateY(${depressedOffsets[prev]}px)`;
  }

  // activate new
  boxes[i].box.classList.remove('dim');
  boxes[i].box.classList.add('active','active-glow');
  // ensure its badge shows current count (might be 0)
  boxes[i].badge.textContent = clickCounts[i] || 0;
}

/* ---------- Open box (treasure chest style slow opening) ---------- */
function openBox(i){
  opened = true;
  const {box,lid,msg,badge} = boxes[i];
  box.classList.add('opened');
  box.classList.remove('active','active-glow','dim');

  // rotate lid to open slowly
  lid.style.transform = 'translateX(-50%) rotateX(-62deg)';
  lid.style.transition = 'transform 1100ms cubic-bezier(.22,.8,.2,1)';

  // show its message (from link or custom)
  const text = targetMessage[i] || DEFAULT_MESSAGES[i];
  msg.textContent = text;
  setTimeout(()=> msg.classList.add('show-message'), 420);

  // reveal snow
  startSnow();

  // show copy/create area remains available (user can create their own)
  // ensure badge final number
  badge.textContent = clickCounts[i] >= 5 ? clickCounts[i] : 5;
}

/* ---------- Modal & Link generation ---------- */
createBtn.addEventListener('click', ()=>{
  friendNameInput.value = '';
  for(let j=0;j<BOX_COUNT;j++) mInputs[j].value = '';
  linkOutput.style.display = 'none';
  generatedLinkInput.value = '';
  modalBackdrop.style.display = 'flex';
  modalBackdrop.setAttribute('aria-hidden','false');
});
modalClose.addEventListener('click', closeModal);
function closeModal(){
  modalBackdrop.style.display = 'none';
  modalBackdrop.setAttribute('aria-hidden','true');
}

generateLinkBtn.addEventListener('click', ()=>{
  const name = friendNameInput.value.trim() || '';
  const mvals = mInputs.map(i=> i.value.trim() || '');
  // require at least one message? we'll allow defaults for empty but include them
  const base = window.location.origin + window.location.pathname;
  const params = new URLSearchParams();
  if(name) params.set('name', name);
  mvals.forEach((mv, idx) => {
    if(mv) params.set('m'+(idx+1), mv);
  });
  const url = `${base}?${params.toString()}`;
  generatedLinkInput.value = url;
  linkOutput.style.display = 'flex';
});

copyLinkBtn.addEventListener('click', async ()=>{
  const val = generatedLinkInput.value;
  if(!val) return;
  try{
    await navigator.clipboard.writeText(val);
    copyLinkBtn.textContent = 'Copied âœ…';
    setTimeout(()=> copyLinkBtn.textContent = 'Copy Link', 1400);
  }catch(e){
    alert('Copy failed â€” manually select and copy the link.');
  }
});

modalBackdrop.addEventListener('click', (ev)=>{
  if(ev.target === modalBackdrop) closeModal();
});

/* ---------- Snow animation (medium) ---------- */
let snowParticles = [], snowRunning = false;
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas(); window.addEventListener('resize', resizeCanvas);

function startSnow(){
  if(snowRunning) return;
  snowRunning = true;
  canvas.style.opacity = '1';
  const count = 160;
  snowParticles = [];
  for(let i=0;i<count;i++){
    snowParticles.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: Math.random()*3 + 1.2,
      vx: (Math.random()-0.5)*0.4,
      vy: Math.random()*1.2 + 0.6,
      phase: Math.random()*Math.PI*2
    });
  }
  requestAnimationFrame(snowFrame);
}
function snowFrame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = 'rgba(255,255,255,0.92)';
  ctx.beginPath();
  for(const p of snowParticles){
    ctx.moveTo(p.x,p.y); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    p.phase += 0.01 + Math.random()*0.01;
    p.x += p.vx + Math.sin(p.phase)*0.3;
    p.y += p.vy;
    if(p.y > canvas.height + 20){ p.y = -10 - Math.random()*40; p.x = Math.random()*canvas.width; }
    if(p.x < -20) p.x = canvas.width + 20;
    if(p.x > canvas.width + 20) p.x = -20;
  }
  ctx.fill();
  if(snowRunning) requestAnimationFrame(snowFrame);
}

/* ---------- Initial small hint: highlight a box (but no text hint) ---------- */
(function initialSelect(){
  const i = Math.floor(Math.random()*BOX_COUNT);
  setTimeout(()=> { if(!opened) onBoxClick(i); }, 600);
})();

/* Prevent text selection to keep UI clean */
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('keydown', e => { if(e.key === 'Escape') closeModal(); });

</script>
</body>
</html>
